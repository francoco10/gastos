<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Gestor de Finanzas</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>



</head>

<body class="bg-gradient-to-br from-blue-900 to-gray-900 min-h-screen text-white p-6">

<div class="max-w-4xl mx-auto bg-gray-800 rounded-xl shadow-xl p-6">
    <div id="auth" class="bg-gray-900 p-4 rounded mb-4 text-center">
  <h2 class="font-bold mb-2">Cuenta</h2>

  <input id="email" type="email" placeholder="Email" class="w-full p-2 mb-2 text-black rounded">
  <input id="password" type="password" placeholder="Contrase帽a" class="w-full p-2 mb-2 text-black rounded">

  <button onclick="register()" class="bg-green-600 w-full p-2 rounded mb-2">
    Crear cuenta
  </button>

  <button onclick="login()" class="bg-blue-600 w-full p-2 rounded">
    Iniciar sesi贸n
  </button>

  <p id="authStatus" class="text-sm mt-2"></p>
</div>


<div id="app" class="hidden">
    <div class="text-right mb-4">
  <button onclick="logout()" class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded">
    Cerrar sesi贸n
  </button>
</div>

<h1 class="text-3xl font-bold text-center mb-6"> Gestor de Finanzas Personales</h1>

<!-- Balance -->
<div class="grid grid-cols-2 gap-4 text-center mb-6">
<div class="bg-green-600 p-4 rounded">
<p>Pesos (ARS)</p>
<p class="text-2xl" id="ars">$0</p>
</div>
<div class="bg-blue-600 p-4 rounded">
<p>D贸lares (USD)</p>
<p class="text-2xl" id="usd">U$S 0</p>
</div>
</div>

<!-- Inicial -->
<div class="bg-gray-700 p-4 rounded mb-4">
<h2 class="font-bold mb-2">Saldo inicial</h2>
<input id="initARS" type="number" placeholder="Pesos" class="w-full p-2 text-black rounded mb-2">
<input id="initUSD" type="number" placeholder="D贸lares" class="w-full p-2 text-black rounded mb-2">
<button onclick="setInitial()" class="w-full bg-green-500 p-2 rounded">Guardar</button>
</div>

<!-- Movimiento -->
<div class="bg-gray-700 p-4 rounded mb-4">
<h2 class="font-bold mb-2">Agregar movimiento</h2>
<select id="type" class="w-full p-2 text-black rounded mb-2">
<option value="ingreso">Ingreso</option>
<option value="gasto">Gasto</option>
</select>
<select id="currency" class="w-full p-2 text-black rounded mb-2">
<option value="ars">Pesos (ARS)</option>
<option value="usd">D贸lares (USD)</option>
</select>
<input id="amount" type="number" placeholder="Monto" class="w-full p-2 text-black rounded mb-2">
<input id="desc" placeholder="Descripci贸n" class="w-full p-2 text-black rounded mb-2">
<button onclick="addMove()" class="w-full bg-blue-500 p-2 rounded">Agregar</button>
</div>

<!-- Historial -->
<div class="bg-gray-700 p-4 rounded mb-4">
<h2 class="font-bold mb-2">Historial</h2>
<ul id="history" class="text-sm"></ul>
</div>

<!-- Resumen -->
<div class="bg-gray-900 p-4 rounded text-center">
<h2 class="font-bold mb-2">Resumen del mes</h2>
<p id="summary"></p>
<p id="result" class="text-xl font-bold mt-2"></p>
</div>
<div class="bg-gray-900 p-4 rounded text-center mt-4">
  <h2 class="font-bold mb-2"> Ingresos vs Gastos</h2>
  <canvas id="financeChart"></canvas>
</div>

</div>

</div>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
const SUPABASE_URL = "https://doefqstczxinchrualpj.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRvZWZxc3RjenhpbmNocnVhbHBqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg0OTY1OTYsImV4cCI6MjA4NDA3MjU5Nn0.BkgHzScYHWZshdCNNvjqEuLWVc9LSy0SoX5UMgYDU1s";

const sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

let user = null;

async function register(){
  const { error } = await sb.auth.signUp({
    email: email.value,
    password: password.value
  });

  authStatus.innerText = error ? error.message : "Cuenta creada. Inici谩 sesi贸n.";
}

async function login(){
  const { data, error } = await sb.auth.signInWithPassword({
    email: email.value,
    password: password.value
  });

  if(error){
    authStatus.innerText = error.message;
  } else {
    user = data.user;
    authStatus.innerText = "Sesi贸n iniciada";
    document.getElementById("auth").classList.add("hidden");
    document.getElementById("app").classList.remove("hidden");
    loadData();
  }
}

async function logout(){
  await sb.auth.signOut();
  location.reload();
}


let data = { ars:0, usd:0, movements:[] };
let chart;

function formatAR(n){
  return n.toLocaleString("es-AR",{minimumFractionDigits:2});
}

function setInitial(){
  data.ars = Number(initARS.value) || 0;
  data.usd = Number(initUSD.value) || 0;
  render();
}

async function addMove(){
  let amt = Number(amount.value);
  let type = document.getElementById("type").value;
  let cur = currency.value;
  let desc = document.getElementById("desc").value;

  if(type=="gasto") amt *= -1;

  await sb.from("movements").insert([{
  amount: amt,
  currency: cur,
  description: desc,
  user_id: user.id
}]);

  loadData();
}

async function loadData(){
  const { data: rows } = await sb
  .from("movements")
  .select("*")
  .eq("user_id", user.id)
  .order("date");


  data.movements = rows || [];
  data.ars = 0;
  data.usd = 0;

  data.movements.forEach(m=>{
    if(m.currency=="ars") data.ars += m.amount;
    if(m.currency=="usd") data.usd += m.amount;
  });

  render();
}

function render(){
  ars.innerText = "$ " + formatAR(data.ars);
  usd.innerText = "U$S " + formatAR(data.usd);

  history.innerHTML="";
  let ingresos=0, gastos=0;

  data.movements.forEach(m=>{
    history.innerHTML += `<li>${new Date(m.date).toLocaleDateString()} - ${m.description} (${m.currency.toUpperCase()} ${formatAR(m.amount)})</li>`;
    if(m.amount>0) ingresos+=m.amount;
    else gastos+=Math.abs(m.amount);
  });

  summary.innerText = `Ingresos: $ ${formatAR(ingresos)} | Gastos: $ ${formatAR(gastos)}`;
  result.innerText = ingresos - gastos > 0 ? " Buen mes" : " Mal mes";

  if(chart) chart.destroy();

  chart = new Chart(document.getElementById("financeChart"),{
    type:"bar",
    data:{
      labels:["Ingresos","Gastos"],
      datasets:[{
        data:[ingresos,gastos],
        backgroundColor:["#22c55e","#ef4444"]
      }]
    },
    options:{plugins:{legend:{display:false}}}
  });
}



sb.auth.getUser().then(({data})=>{
  if(data.user){
    user = data.user;
    document.getElementById("auth").classList.add("hidden");
    document.getElementById("app").classList.remove("hidden");
    loadData();
  }
});

</script>


</body>
</html>



